
#line 1 "uri_parser.rl"
#include <stdio.h>
#include "uri_parser.h"
#include <stdlib.h>
#include <assert.h>
#include <ctype.h>
#include <string.h>
#include <stddef.h>
#include "mymdebug.h"


#include <stdio.h>

#define URI_DEFINE_SETTER(field) \
  static void uri_set_##field(uri_t *u, const char *s, ssize_t l) { \
    if (!u) return; \
    if (s == 0) { u->field = 0; return; } \
    if (l == -1) { l = strlen(s); } \
    u->field = MYMALLOC(l+1); \
    if (!u->field) return; \
    memcpy(u->field, s, l); \
    *(u->field+l) = '\0'; \
  }

URI_DEFINE_SETTER(scheme)
URI_DEFINE_SETTER(userinfo)
URI_DEFINE_SETTER(host)
URI_DEFINE_SETTER(path)
URI_DEFINE_SETTER(query)
URI_DEFINE_SETTER(fragment)


#line 75 "uri_parser.rl"



#line 39 "uri_parser.c"
static const char _uri_parser_actions[] = {
	0, 1, 0, 1, 1, 1, 2, 1, 
	3, 1, 5, 1, 6, 1, 7, 2, 
	0, 2, 2, 0, 3, 2, 0, 4, 
	2, 0, 5, 2, 3, 0, 2, 4, 
	0, 2, 5, 0, 2, 6, 0, 3, 
	0, 3, 5, 3, 0, 4, 5, 3, 
	3, 0, 5, 3, 4, 0, 5
};

static const short _uri_parser_key_offsets[] = {
	0, 0, 4, 14, 22, 28, 34, 40, 
	46, 54, 60, 66, 72, 78, 86, 92, 
	98, 104, 110, 118, 124, 130, 136, 142, 
	156, 164, 170, 176, 182, 188, 196, 202, 
	208, 214, 220, 228, 235, 242, 249, 250, 
	257, 264, 271, 278, 279, 286, 293, 300, 
	307, 308, 315, 322, 329, 336, 337, 344, 
	351, 358, 365, 366, 373, 380, 387, 394, 
	395, 405, 413, 418, 419, 424, 425, 430, 
	431, 434, 437, 443, 446, 449, 452, 458, 
	461, 464, 467, 473, 476, 483, 490, 491, 
	498, 505, 512, 519, 527, 535, 543, 554, 
	564, 572, 580, 587, 594, 604, 613, 621, 
	629, 631, 637, 646, 655, 664, 676, 687, 
	696, 705, 713, 723, 732, 740, 748, 750, 
	759, 768, 777, 786, 798, 809, 818, 827, 
	835, 845, 854, 862, 870, 872, 881, 890, 
	899, 908, 920, 931, 940, 949, 957, 967, 
	976, 984, 992, 994, 1003, 1012, 1021, 1030, 
	1042, 1053, 1062, 1071, 1079, 1089, 1098, 1106, 
	1114, 1116, 1125, 1134, 1143, 1152, 1164, 1175, 
	1184, 1193, 1201, 1202, 1212, 1221, 1229, 1237, 
	1239, 1248, 1257, 1266, 1275, 1287, 1298, 1307, 
	1316, 1324, 1330, 1331, 1344, 1360, 1375, 1388, 
	1402, 1418, 1435, 1451, 1470, 1486, 1501, 1506, 
	1511, 1515
};

static const char _uri_parser_trans_keys[] = {
	65, 90, 97, 122, 43, 58, 45, 46, 
	48, 57, 65, 90, 97, 122, 37, 117, 
	48, 57, 65, 70, 97, 102, 48, 57, 
	65, 70, 97, 102, 48, 57, 65, 70, 
	97, 102, 48, 57, 65, 70, 97, 102, 
	48, 57, 65, 70, 97, 102, 37, 117, 
	48, 57, 65, 70, 97, 102, 48, 57, 
	65, 70, 97, 102, 48, 57, 65, 70, 
	97, 102, 48, 57, 65, 70, 97, 102, 
	48, 57, 65, 70, 97, 102, 37, 117, 
	48, 57, 65, 70, 97, 102, 48, 57, 
	65, 70, 97, 102, 48, 57, 65, 70, 
	97, 102, 48, 57, 65, 70, 97, 102, 
	48, 57, 65, 70, 97, 102, 37, 117, 
	48, 57, 65, 70, 97, 102, 48, 57, 
	65, 70, 97, 102, 48, 57, 65, 70, 
	97, 102, 48, 57, 65, 70, 97, 102, 
	48, 57, 65, 70, 97, 102, 33, 37, 
	61, 64, 95, 126, 36, 46, 48, 59, 
	65, 90, 97, 122, 37, 117, 48, 57, 
	65, 70, 97, 102, 48, 57, 65, 70, 
	97, 102, 48, 57, 65, 70, 97, 102, 
	48, 57, 65, 70, 97, 102, 48, 57, 
	65, 70, 97, 102, 37, 117, 48, 57, 
	65, 70, 97, 102, 48, 57, 65, 70, 
	97, 102, 48, 57, 65, 70, 97, 102, 
	48, 57, 65, 70, 97, 102, 48, 57, 
	65, 70, 97, 102, 58, 118, 48, 57, 
	65, 70, 97, 102, 58, 48, 57, 65, 
	70, 97, 102, 58, 48, 57, 65, 70, 
	97, 102, 58, 48, 57, 65, 70, 97, 
	102, 58, 58, 48, 57, 65, 70, 97, 
	102, 58, 48, 57, 65, 70, 97, 102, 
	58, 48, 57, 65, 70, 97, 102, 58, 
	48, 57, 65, 70, 97, 102, 58, 58, 
	48, 57, 65, 70, 97, 102, 58, 48, 
	57, 65, 70, 97, 102, 58, 48, 57, 
	65, 70, 97, 102, 58, 48, 57, 65, 
	70, 97, 102, 58, 58, 48, 57, 65, 
	70, 97, 102, 58, 48, 57, 65, 70, 
	97, 102, 58, 48, 57, 65, 70, 97, 
	102, 58, 48, 57, 65, 70, 97, 102, 
	58, 58, 48, 57, 65, 70, 97, 102, 
	58, 48, 57, 65, 70, 97, 102, 58, 
	48, 57, 65, 70, 97, 102, 58, 48, 
	57, 65, 70, 97, 102, 58, 58, 48, 
	57, 65, 70, 97, 102, 58, 48, 57, 
	65, 70, 97, 102, 58, 48, 57, 65, 
	70, 97, 102, 58, 48, 57, 65, 70, 
	97, 102, 58, 48, 49, 50, 58, 51, 
	57, 65, 70, 97, 102, 46, 58, 48, 
	57, 65, 70, 97, 102, 48, 49, 50, 
	51, 57, 46, 48, 49, 50, 51, 57, 
	46, 48, 49, 50, 51, 57, 93, 93, 
	48, 57, 93, 48, 57, 53, 93, 48, 
	52, 54, 57, 93, 48, 52, 46, 48, 
	57, 46, 48, 57, 46, 53, 48, 52, 
	54, 57, 46, 48, 52, 46, 48, 57, 
	46, 48, 57, 46, 53, 48, 52, 54, 
	57, 46, 48, 52, 58, 48, 57, 65, 
	70, 97, 102, 58, 48, 57, 65, 70, 
	97, 102, 58, 58, 48, 57, 65, 70, 
	97, 102, 93, 48, 57, 65, 70, 97, 
	102, 93, 48, 57, 65, 70, 97, 102, 
	93, 48, 57, 65, 70, 97, 102, 46, 
	58, 48, 57, 65, 70, 97, 102, 46, 
	58, 48, 57, 65, 70, 97, 102, 46, 
	58, 48, 57, 65, 70, 97, 102, 46, 
	53, 58, 48, 52, 54, 57, 65, 70, 
	97, 102, 46, 58, 48, 52, 53, 57, 
	65, 70, 97, 102, 46, 58, 48, 57, 
	65, 70, 97, 102, 46, 58, 48, 57, 
	65, 70, 97, 102, 93, 48, 57, 65, 
	70, 97, 102, 58, 48, 57, 65, 70, 
	97, 102, 48, 49, 50, 93, 51, 57, 
	65, 70, 97, 102, 46, 58, 93, 48, 
	57, 65, 70, 97, 102, 58, 93, 48, 
	57, 65, 70, 97, 102, 58, 93, 48, 
	57, 65, 70, 97, 102, 58, 93, 48, 
	57, 65, 70, 97, 102, 46, 58, 93, 
	48, 57, 65, 70, 97, 102, 46, 58, 
	93, 48, 57, 65, 70, 97, 102, 46, 
	58, 93, 48, 57, 65, 70, 97, 102, 
	46, 53, 58, 93, 48, 52, 54, 57, 
	65, 70, 97, 102, 46, 58, 93, 48, 
	52, 53, 57, 65, 70, 97, 102, 46, 
	58, 93, 48, 57, 65, 70, 97, 102, 
	46, 58, 93, 48, 57, 65, 70, 97, 
	102, 58, 93, 48, 57, 65, 70, 97, 
	102, 48, 49, 50, 93, 51, 57, 65, 
	70, 97, 102, 46, 58, 93, 48, 57, 
	65, 70, 97, 102, 58, 93, 48, 57, 
	65, 70, 97, 102, 58, 93, 48, 57, 
	65, 70, 97, 102, 58, 93, 48, 49, 
	50, 51, 57, 65, 70, 97, 102, 46, 
	58, 93, 48, 57, 65, 70, 97, 102, 
	46, 58, 93, 48, 57, 65, 70, 97, 
	102, 46, 58, 93, 48, 57, 65, 70, 
	97, 102, 46, 53, 58, 93, 48, 52, 
	54, 57, 65, 70, 97, 102, 46, 58, 
	93, 48, 52, 53, 57, 65, 70, 97, 
	102, 46, 58, 93, 48, 57, 65, 70, 
	97, 102, 46, 58, 93, 48, 57, 65, 
	70, 97, 102, 58, 93, 48, 57, 65, 
	70, 97, 102, 48, 49, 50, 93, 51, 
	57, 65, 70, 97, 102, 46, 58, 93, 
	48, 57, 65, 70, 97, 102, 58, 93, 
	48, 57, 65, 70, 97, 102, 58, 93, 
	48, 57, 65, 70, 97, 102, 58, 93, 
	48, 49, 50, 51, 57, 65, 70, 97, 
	102, 46, 58, 93, 48, 57, 65, 70, 
	97, 102, 46, 58, 93, 48, 57, 65, 
	70, 97, 102, 46, 58, 93, 48, 57, 
	65, 70, 97, 102, 46, 53, 58, 93, 
	48, 52, 54, 57, 65, 70, 97, 102, 
	46, 58, 93, 48, 52, 53, 57, 65, 
	70, 97, 102, 46, 58, 93, 48, 57, 
	65, 70, 97, 102, 46, 58, 93, 48, 
	57, 65, 70, 97, 102, 58, 93, 48, 
	57, 65, 70, 97, 102, 48, 49, 50, 
	93, 51, 57, 65, 70, 97, 102, 46, 
	58, 93, 48, 57, 65, 70, 97, 102, 
	58, 93, 48, 57, 65, 70, 97, 102, 
	58, 93, 48, 57, 65, 70, 97, 102, 
	58, 93, 48, 49, 50, 51, 57, 65, 
	70, 97, 102, 46, 58, 93, 48, 57, 
	65, 70, 97, 102, 46, 58, 93, 48, 
	57, 65, 70, 97, 102, 46, 58, 93, 
	48, 57, 65, 70, 97, 102, 46, 53, 
	58, 93, 48, 52, 54, 57, 65, 70, 
	97, 102, 46, 58, 93, 48, 52, 53, 
	57, 65, 70, 97, 102, 46, 58, 93, 
	48, 57, 65, 70, 97, 102, 46, 58, 
	93, 48, 57, 65, 70, 97, 102, 58, 
	93, 48, 57, 65, 70, 97, 102, 48, 
	49, 50, 93, 51, 57, 65, 70, 97, 
	102, 46, 58, 93, 48, 57, 65, 70, 
	97, 102, 58, 93, 48, 57, 65, 70, 
	97, 102, 58, 93, 48, 57, 65, 70, 
	97, 102, 58, 93, 48, 49, 50, 51, 
	57, 65, 70, 97, 102, 46, 58, 93, 
	48, 57, 65, 70, 97, 102, 46, 58, 
	93, 48, 57, 65, 70, 97, 102, 46, 
	58, 93, 48, 57, 65, 70, 97, 102, 
	46, 53, 58, 93, 48, 52, 54, 57, 
	65, 70, 97, 102, 46, 58, 93, 48, 
	52, 53, 57, 65, 70, 97, 102, 46, 
	58, 93, 48, 57, 65, 70, 97, 102, 
	46, 58, 93, 48, 57, 65, 70, 97, 
	102, 58, 93, 48, 57, 65, 70, 97, 
	102, 58, 48, 49, 50, 93, 51, 57, 
	65, 70, 97, 102, 46, 58, 93, 48, 
	57, 65, 70, 97, 102, 58, 93, 48, 
	57, 65, 70, 97, 102, 58, 93, 48, 
	57, 65, 70, 97, 102, 58, 93, 48, 
	49, 50, 51, 57, 65, 70, 97, 102, 
	46, 58, 93, 48, 57, 65, 70, 97, 
	102, 46, 58, 93, 48, 57, 65, 70, 
	97, 102, 46, 58, 93, 48, 57, 65, 
	70, 97, 102, 46, 53, 58, 93, 48, 
	52, 54, 57, 65, 70, 97, 102, 46, 
	58, 93, 48, 52, 53, 57, 65, 70, 
	97, 102, 46, 58, 93, 48, 57, 65, 
	70, 97, 102, 46, 58, 93, 48, 57, 
	65, 70, 97, 102, 58, 93, 48, 57, 
	65, 70, 97, 102, 48, 57, 65, 70, 
	97, 102, 46, 33, 36, 61, 95, 126, 
	38, 46, 48, 59, 65, 90, 97, 122, 
	33, 35, 37, 47, 61, 63, 93, 95, 
	124, 126, 36, 59, 64, 91, 97, 122, 
	33, 35, 37, 61, 63, 93, 95, 124, 
	126, 36, 59, 64, 91, 97, 122, 33, 
	37, 61, 93, 95, 124, 126, 36, 59, 
	63, 91, 97, 122, 33, 35, 37, 61, 
	93, 95, 124, 126, 36, 59, 63, 91, 
	97, 122, 33, 35, 37, 47, 61, 63, 
	93, 95, 124, 126, 36, 59, 64, 91, 
	97, 122, 33, 35, 37, 47, 58, 61, 
	63, 64, 91, 95, 126, 36, 59, 65, 
	90, 97, 122, 33, 35, 37, 47, 58, 
	61, 63, 64, 95, 126, 36, 59, 65, 
	90, 97, 122, 33, 35, 37, 47, 61, 
	63, 64, 95, 126, 36, 46, 48, 57, 
	58, 59, 65, 90, 97, 122, 33, 35, 
	37, 47, 58, 61, 63, 91, 95, 126, 
	36, 59, 65, 90, 97, 122, 33, 35, 
	37, 47, 58, 61, 63, 95, 126, 36, 
	59, 65, 90, 97, 122, 35, 47, 63, 
	48, 57, 35, 47, 63, 48, 57, 35, 
	47, 58, 63, 33, 35, 37, 47, 61, 
	63, 64, 95, 126, 36, 46, 48, 57, 
	58, 59, 65, 90, 97, 122, 0
};

static const char _uri_parser_single_lengths[] = {
	0, 0, 2, 2, 0, 0, 0, 0, 
	2, 0, 0, 0, 0, 2, 0, 0, 
	0, 0, 2, 0, 0, 0, 0, 6, 
	2, 0, 0, 0, 0, 2, 0, 0, 
	0, 0, 2, 1, 1, 1, 1, 1, 
	1, 1, 1, 1, 1, 1, 1, 1, 
	1, 1, 1, 1, 1, 1, 1, 1, 
	1, 1, 1, 1, 1, 1, 1, 1, 
	4, 2, 3, 1, 3, 1, 3, 1, 
	1, 1, 2, 1, 1, 1, 2, 1, 
	1, 1, 2, 1, 1, 1, 1, 1, 
	1, 1, 1, 2, 2, 2, 3, 2, 
	2, 2, 1, 1, 4, 3, 2, 2, 
	2, 0, 3, 3, 3, 4, 3, 3, 
	3, 2, 4, 3, 2, 2, 2, 3, 
	3, 3, 3, 4, 3, 3, 3, 2, 
	4, 3, 2, 2, 2, 3, 3, 3, 
	3, 4, 3, 3, 3, 2, 4, 3, 
	2, 2, 2, 3, 3, 3, 3, 4, 
	3, 3, 3, 2, 4, 3, 2, 2, 
	2, 3, 3, 3, 3, 4, 3, 3, 
	3, 2, 1, 4, 3, 2, 2, 2, 
	3, 3, 3, 3, 4, 3, 3, 3, 
	2, 0, 1, 5, 10, 9, 7, 8, 
	10, 11, 10, 9, 10, 9, 3, 3, 
	4, 9
};

static const char _uri_parser_range_lengths[] = {
	0, 2, 4, 3, 3, 3, 3, 3, 
	3, 3, 3, 3, 3, 3, 3, 3, 
	3, 3, 3, 3, 3, 3, 3, 4, 
	3, 3, 3, 3, 3, 3, 3, 3, 
	3, 3, 3, 3, 3, 3, 0, 3, 
	3, 3, 3, 0, 3, 3, 3, 3, 
	0, 3, 3, 3, 3, 0, 3, 3, 
	3, 3, 0, 3, 3, 3, 3, 0, 
	3, 3, 1, 0, 1, 0, 1, 0, 
	1, 1, 2, 1, 1, 1, 2, 1, 
	1, 1, 2, 1, 3, 3, 0, 3, 
	3, 3, 3, 3, 3, 3, 4, 4, 
	3, 3, 3, 3, 3, 3, 3, 3, 
	0, 3, 3, 3, 3, 4, 4, 3, 
	3, 3, 3, 3, 3, 3, 0, 3, 
	3, 3, 3, 4, 4, 3, 3, 3, 
	3, 3, 3, 3, 0, 3, 3, 3, 
	3, 4, 4, 3, 3, 3, 3, 3, 
	3, 3, 0, 3, 3, 3, 3, 4, 
	4, 3, 3, 3, 3, 3, 3, 3, 
	0, 3, 3, 3, 3, 4, 4, 3, 
	3, 3, 0, 3, 3, 3, 3, 0, 
	3, 3, 3, 3, 4, 4, 3, 3, 
	3, 3, 0, 4, 3, 3, 3, 3, 
	3, 3, 3, 5, 3, 3, 1, 1, 
	0, 5
};

static const short _uri_parser_index_offsets[] = {
	0, 0, 3, 10, 16, 20, 24, 28, 
	32, 38, 42, 46, 50, 54, 60, 64, 
	68, 72, 76, 82, 86, 90, 94, 98, 
	109, 115, 119, 123, 127, 131, 137, 141, 
	145, 149, 153, 159, 164, 169, 174, 176, 
	181, 186, 191, 196, 198, 203, 208, 213, 
	218, 220, 225, 230, 235, 240, 242, 247, 
	252, 257, 262, 264, 269, 274, 279, 284, 
	286, 294, 300, 305, 307, 312, 314, 319, 
	321, 324, 327, 332, 335, 338, 341, 346, 
	349, 352, 355, 360, 363, 368, 373, 375, 
	380, 385, 390, 395, 401, 407, 413, 421, 
	428, 434, 440, 445, 450, 458, 465, 471, 
	477, 480, 484, 491, 498, 505, 514, 522, 
	529, 536, 542, 550, 557, 563, 569, 572, 
	579, 586, 593, 600, 609, 617, 624, 631, 
	637, 645, 652, 658, 664, 667, 674, 681, 
	688, 695, 704, 712, 719, 726, 732, 740, 
	747, 753, 759, 762, 769, 776, 783, 790, 
	799, 807, 814, 821, 827, 835, 842, 848, 
	854, 857, 864, 871, 878, 885, 894, 902, 
	909, 916, 922, 924, 932, 939, 945, 951, 
	954, 961, 968, 975, 982, 991, 999, 1006, 
	1013, 1019, 1023, 1025, 1035, 1049, 1062, 1073, 
	1085, 1099, 1114, 1128, 1143, 1157, 1170, 1175, 
	1180, 1185
};

static const unsigned char _uri_parser_indicies[] = {
	0, 0, 1, 2, 3, 2, 2, 2, 
	2, 1, 4, 5, 4, 4, 4, 1, 
	6, 6, 6, 1, 7, 7, 7, 1, 
	8, 8, 8, 1, 4, 4, 4, 1, 
	9, 10, 9, 9, 9, 1, 11, 11, 
	11, 1, 12, 12, 12, 1, 13, 13, 
	13, 1, 9, 9, 9, 1, 14, 15, 
	14, 14, 14, 1, 16, 16, 16, 1, 
	17, 17, 17, 1, 18, 18, 18, 1, 
	14, 14, 14, 1, 19, 20, 19, 19, 
	19, 1, 21, 21, 21, 1, 22, 22, 
	22, 1, 23, 23, 23, 1, 19, 19, 
	19, 1, 24, 25, 24, 26, 24, 24, 
	24, 24, 24, 24, 1, 24, 27, 24, 
	24, 24, 1, 28, 28, 28, 1, 29, 
	29, 29, 1, 30, 30, 30, 1, 24, 
	24, 24, 1, 31, 32, 31, 31, 31, 
	1, 33, 33, 33, 1, 34, 34, 34, 
	1, 35, 35, 35, 1, 31, 31, 31, 
	1, 37, 38, 36, 36, 36, 1, 40, 
	39, 39, 39, 1, 40, 41, 41, 41, 
	1, 40, 42, 42, 42, 1, 40, 1, 
	44, 43, 43, 43, 1, 46, 45, 45, 
	45, 1, 46, 47, 47, 47, 1, 46, 
	48, 48, 48, 1, 46, 1, 50, 49, 
	49, 49, 1, 52, 51, 51, 51, 1, 
	52, 53, 53, 53, 1, 52, 54, 54, 
	54, 1, 52, 1, 56, 55, 55, 55, 
	1, 58, 57, 57, 57, 1, 58, 59, 
	59, 59, 1, 58, 60, 60, 60, 1, 
	58, 1, 62, 61, 61, 61, 1, 64, 
	63, 63, 63, 1, 64, 65, 65, 65, 
	1, 64, 66, 66, 66, 1, 64, 1, 
	68, 67, 67, 67, 1, 70, 69, 69, 
	69, 1, 70, 71, 71, 71, 1, 70, 
	72, 72, 72, 1, 70, 1, 73, 74, 
	75, 77, 76, 78, 78, 1, 79, 81, 
	80, 80, 80, 1, 82, 83, 84, 85, 
	1, 86, 1, 87, 88, 89, 90, 1, 
	91, 1, 92, 93, 94, 95, 1, 96, 
	1, 96, 95, 1, 96, 92, 1, 97, 
	96, 95, 92, 1, 96, 92, 1, 91, 
	90, 1, 91, 87, 1, 91, 98, 90, 
	87, 1, 91, 87, 1, 86, 85, 1, 
	86, 82, 1, 86, 99, 85, 82, 1, 
	86, 82, 1, 81, 100, 100, 100, 1, 
	81, 101, 101, 101, 1, 81, 1, 92, 
	102, 102, 102, 1, 96, 103, 103, 103, 
	1, 96, 104, 104, 104, 1, 96, 92, 
	92, 92, 1, 79, 81, 105, 80, 80, 
	1, 79, 81, 106, 100, 100, 1, 79, 
	81, 101, 101, 101, 1, 79, 107, 81, 
	105, 108, 80, 80, 1, 79, 81, 106, 
	100, 100, 100, 1, 79, 81, 100, 100, 
	100, 1, 79, 81, 108, 80, 80, 1, 
	96, 102, 102, 102, 1, 81, 80, 80, 
	80, 1, 109, 110, 111, 96, 112, 113, 
	113, 1, 79, 115, 96, 114, 114, 114, 
	1, 115, 96, 116, 116, 116, 1, 115, 
	96, 117, 117, 117, 1, 115, 96, 1, 
	102, 102, 102, 1, 79, 115, 96, 118, 
	114, 114, 1, 79, 115, 96, 119, 116, 
	116, 1, 79, 115, 96, 117, 117, 117, 
	1, 79, 120, 115, 96, 118, 121, 114, 
	114, 1, 79, 115, 96, 119, 116, 116, 
	116, 1, 79, 115, 96, 116, 116, 116, 
	1, 79, 115, 96, 121, 114, 114, 1, 
	115, 96, 114, 114, 114, 1, 122, 123, 
	124, 96, 125, 126, 126, 1, 79, 128, 
	96, 127, 127, 127, 1, 128, 96, 129, 
	129, 129, 1, 128, 96, 130, 130, 130, 
	1, 128, 96, 1, 109, 110, 111, 112, 
	113, 113, 1, 79, 128, 96, 131, 127, 
	127, 1, 79, 128, 96, 132, 129, 129, 
	1, 79, 128, 96, 130, 130, 130, 1, 
	79, 133, 128, 96, 131, 134, 127, 127, 
	1, 79, 128, 96, 132, 129, 129, 129, 
	1, 79, 128, 96, 129, 129, 129, 1, 
	79, 128, 96, 134, 127, 127, 1, 128, 
	96, 127, 127, 127, 1, 135, 136, 137, 
	96, 138, 139, 139, 1, 79, 141, 96, 
	140, 140, 140, 1, 141, 96, 142, 142, 
	142, 1, 141, 96, 143, 143, 143, 1, 
	141, 96, 1, 122, 123, 124, 125, 126, 
	126, 1, 79, 141, 96, 144, 140, 140, 
	1, 79, 141, 96, 145, 142, 142, 1, 
	79, 141, 96, 143, 143, 143, 1, 79, 
	146, 141, 96, 144, 147, 140, 140, 1, 
	79, 141, 96, 145, 142, 142, 142, 1, 
	79, 141, 96, 142, 142, 142, 1, 79, 
	141, 96, 147, 140, 140, 1, 141, 96, 
	140, 140, 140, 1, 148, 149, 150, 96, 
	151, 152, 152, 1, 79, 154, 96, 153, 
	153, 153, 1, 154, 96, 155, 155, 155, 
	1, 154, 96, 156, 156, 156, 1, 154, 
	96, 1, 135, 136, 137, 138, 139, 139, 
	1, 79, 154, 96, 157, 153, 153, 1, 
	79, 154, 96, 158, 155, 155, 1, 79, 
	154, 96, 156, 156, 156, 1, 79, 159, 
	154, 96, 157, 160, 153, 153, 1, 79, 
	154, 96, 158, 155, 155, 155, 1, 79, 
	154, 96, 155, 155, 155, 1, 79, 154, 
	96, 160, 153, 153, 1, 154, 96, 153, 
	153, 153, 1, 161, 162, 163, 96, 164, 
	165, 165, 1, 79, 167, 96, 166, 166, 
	166, 1, 167, 96, 168, 168, 168, 1, 
	167, 96, 169, 169, 169, 1, 167, 96, 
	1, 148, 149, 150, 151, 152, 152, 1, 
	79, 167, 96, 170, 166, 166, 1, 79, 
	167, 96, 171, 168, 168, 1, 79, 167, 
	96, 169, 169, 169, 1, 79, 172, 167, 
	96, 170, 173, 166, 166, 1, 79, 167, 
	96, 171, 168, 168, 168, 1, 79, 167, 
	96, 168, 168, 168, 1, 79, 167, 96, 
	173, 166, 166, 1, 167, 96, 166, 166, 
	166, 1, 174, 1, 175, 176, 177, 96, 
	178, 179, 179, 1, 79, 181, 96, 180, 
	180, 180, 1, 181, 96, 182, 182, 182, 
	1, 181, 96, 183, 183, 183, 1, 181, 
	96, 1, 161, 162, 163, 164, 165, 165, 
	1, 79, 181, 96, 184, 180, 180, 1, 
	79, 181, 96, 185, 182, 182, 1, 79, 
	181, 96, 183, 183, 183, 1, 79, 186, 
	181, 96, 184, 187, 180, 180, 1, 79, 
	181, 96, 185, 182, 182, 182, 1, 79, 
	181, 96, 182, 182, 182, 1, 79, 181, 
	96, 187, 180, 180, 1, 181, 96, 180, 
	180, 180, 1, 188, 188, 188, 1, 189, 
	1, 92, 92, 92, 92, 92, 92, 92, 
	92, 92, 1, 9, 190, 191, 192, 9, 
	193, 9, 9, 9, 9, 9, 9, 9, 
	1, 9, 190, 191, 9, 193, 9, 9, 
	9, 9, 9, 9, 9, 1, 4, 194, 
	4, 4, 4, 4, 4, 4, 4, 4, 
	1, 14, 195, 196, 14, 14, 14, 14, 
	14, 14, 14, 14, 1, 9, 190, 191, 
	197, 9, 193, 9, 9, 9, 9, 9, 
	9, 9, 1, 198, 199, 200, 201, 202, 
	198, 203, 204, 205, 198, 198, 198, 198, 
	198, 1, 19, 206, 207, 208, 209, 19, 
	210, 26, 19, 19, 19, 19, 19, 1, 
	24, 211, 25, 212, 24, 214, 26, 24, 
	24, 24, 213, 24, 24, 24, 1, 215, 
	199, 216, 201, 217, 215, 203, 205, 215, 
	215, 215, 215, 215, 1, 31, 206, 218, 
	208, 219, 31, 210, 31, 31, 31, 31, 
	31, 1, 211, 212, 214, 220, 1, 221, 
	222, 224, 223, 1, 225, 226, 227, 228, 
	1, 24, 221, 25, 222, 24, 224, 26, 
	24, 24, 24, 229, 24, 24, 24, 1, 
	0
};

static const unsigned char _uri_parser_trans_targs[] = {
	2, 0, 2, 188, 190, 4, 5, 6, 
	7, 189, 9, 10, 11, 12, 191, 14, 
	15, 16, 17, 194, 19, 20, 21, 22, 
	23, 24, 196, 25, 26, 27, 28, 197, 
	30, 31, 32, 33, 35, 170, 185, 36, 
	39, 37, 38, 40, 156, 41, 44, 42, 
	43, 45, 142, 46, 49, 47, 48, 50, 
	128, 51, 54, 52, 53, 55, 114, 56, 
	59, 57, 58, 60, 100, 61, 64, 62, 
	63, 65, 91, 94, 97, 98, 99, 66, 
	84, 87, 67, 80, 82, 81, 68, 69, 
	76, 78, 77, 70, 71, 72, 74, 73, 
	200, 75, 79, 83, 85, 86, 88, 89, 
	90, 92, 93, 95, 96, 101, 106, 109, 
	112, 113, 102, 105, 103, 104, 107, 108, 
	110, 111, 115, 120, 123, 126, 127, 116, 
	119, 117, 118, 121, 122, 124, 125, 129, 
	134, 137, 140, 141, 130, 133, 131, 132, 
	135, 136, 138, 139, 143, 148, 151, 154, 
	155, 144, 147, 145, 146, 149, 150, 152, 
	153, 157, 162, 165, 168, 169, 158, 161, 
	159, 160, 163, 164, 166, 167, 171, 172, 
	177, 180, 183, 184, 173, 176, 174, 175, 
	178, 179, 181, 182, 186, 187, 190, 8, 
	192, 191, 3, 190, 13, 193, 194, 190, 
	18, 189, 195, 191, 196, 34, 190, 18, 
	189, 195, 191, 190, 189, 201, 191, 197, 
	29, 198, 29, 198, 199, 190, 189, 199, 
	191, 190, 189, 198, 191, 201
};

static const char _uri_parser_trans_actions[] = {
	1, 0, 0, 3, 0, 0, 0, 0, 
	0, 0, 0, 0, 0, 0, 0, 0, 
	0, 0, 0, 0, 0, 0, 0, 0, 
	0, 0, 5, 0, 0, 0, 0, 0, 
	0, 0, 0, 0, 0, 0, 0, 0, 
	0, 0, 0, 0, 0, 0, 0, 0, 
	0, 0, 0, 0, 0, 0, 0, 0, 
	0, 0, 0, 0, 0, 0, 0, 0, 
	0, 0, 0, 0, 0, 0, 0, 0, 
	0, 0, 0, 0, 0, 0, 0, 0, 
	0, 0, 0, 0, 0, 0, 0, 0, 
	0, 0, 0, 0, 0, 0, 0, 0, 
	0, 0, 0, 0, 0, 0, 0, 0, 
	0, 0, 0, 0, 0, 0, 0, 0, 
	0, 0, 0, 0, 0, 0, 0, 0, 
	0, 0, 0, 0, 0, 0, 0, 0, 
	0, 0, 0, 0, 0, 0, 0, 0, 
	0, 0, 0, 0, 0, 0, 0, 0, 
	0, 0, 0, 0, 0, 0, 0, 0, 
	0, 0, 0, 0, 0, 0, 0, 0, 
	0, 0, 0, 0, 0, 0, 0, 0, 
	0, 0, 0, 0, 0, 0, 0, 0, 
	0, 0, 0, 0, 0, 0, 0, 0, 
	0, 0, 0, 0, 0, 0, 33, 0, 
	0, 33, 0, 36, 0, 0, 1, 39, 
	1, 18, 18, 39, 15, 0, 47, 0, 
	27, 7, 47, 43, 21, 1, 43, 1, 
	1, 18, 0, 7, 1, 51, 30, 0, 
	51, 24, 1, 0, 24, 0
};

static const char _uri_parser_eof_actions[] = {
	0, 0, 0, 0, 0, 0, 0, 0, 
	0, 0, 0, 0, 0, 0, 0, 0, 
	0, 0, 0, 0, 0, 0, 0, 0, 
	0, 0, 0, 0, 0, 0, 0, 0, 
	0, 0, 0, 0, 0, 0, 0, 0, 
	0, 0, 0, 0, 0, 0, 0, 0, 
	0, 0, 0, 0, 0, 0, 0, 0, 
	0, 0, 0, 0, 0, 0, 0, 0, 
	0, 0, 0, 0, 0, 0, 0, 0, 
	0, 0, 0, 0, 0, 0, 0, 0, 
	0, 0, 0, 0, 0, 0, 0, 0, 
	0, 0, 0, 0, 0, 0, 0, 0, 
	0, 0, 0, 0, 0, 0, 0, 0, 
	0, 0, 0, 0, 0, 0, 0, 0, 
	0, 0, 0, 0, 0, 0, 0, 0, 
	0, 0, 0, 0, 0, 0, 0, 0, 
	0, 0, 0, 0, 0, 0, 0, 0, 
	0, 0, 0, 0, 0, 0, 0, 0, 
	0, 0, 0, 0, 0, 0, 0, 0, 
	0, 0, 0, 0, 0, 0, 0, 0, 
	0, 0, 0, 0, 0, 0, 0, 0, 
	0, 0, 0, 0, 0, 0, 0, 0, 
	0, 0, 0, 0, 0, 0, 0, 0, 
	0, 0, 0, 0, 9, 9, 13, 11, 
	9, 39, 47, 43, 39, 47, 43, 51, 
	24, 51
};

static const int uri_parser_start = 1;
static const int uri_parser_first_final = 188;
static const int uri_parser_error = 0;

static const int uri_parser_en_main = 1;


#line 78 "uri_parser.rl"

static void uri_zero(uri_t *u) {
/* zero everything */
  MYFREE(u->scheme); u->scheme = NULL;
  MYFREE(u->userinfo); u->userinfo = NULL;
  MYFREE(u->host); u->host = NULL;
  MYFREE(u->path); u->path = NULL;
  MYFREE(u->query); u->query = NULL;
  MYFREE(u->fragment); u->fragment = NULL;
  u->port = 80;
}

uri_t *uri_new(void) {
  uri_t *u = MYCALLOC(1, sizeof(uri_t));
  u->port = 80;
  return u;
}

int uri_parse(uri_t *u, const char *buf, size_t len, const char **error_at) {
  if (!u) return 0;
  const char *mark = NULL;
  const char *p, *pe, *eof;
  int cs = 0;

  if (error_at != NULL) {
    *error_at = NULL;
  }

  
#line 645 "uri_parser.c"
	{
	cs = uri_parser_start;
	}

#line 107 "uri_parser.rl"

  p = buf;
  pe = buf+len;
  eof = pe;

  
#line 657 "uri_parser.c"
	{
	int _klen;
	unsigned int _trans;
	const char *_acts;
	unsigned int _nacts;
	const char *_keys;

	if ( p == pe )
		goto _test_eof;
	if ( cs == 0 )
		goto _out;
_resume:
	_keys = _uri_parser_trans_keys + _uri_parser_key_offsets[cs];
	_trans = _uri_parser_index_offsets[cs];

	_klen = _uri_parser_single_lengths[cs];
	if ( _klen > 0 ) {
		const char *_lower = _keys;
		const char *_mid;
		const char *_upper = _keys + _klen - 1;
		while (1) {
			if ( _upper < _lower )
				break;

			_mid = _lower + ((_upper-_lower) >> 1);
			if ( (*p) < *_mid )
				_upper = _mid - 1;
			else if ( (*p) > *_mid )
				_lower = _mid + 1;
			else {
				_trans += (unsigned int)(_mid - _keys);
				goto _match;
			}
		}
		_keys += _klen;
		_trans += _klen;
	}

	_klen = _uri_parser_range_lengths[cs];
	if ( _klen > 0 ) {
		const char *_lower = _keys;
		const char *_mid;
		const char *_upper = _keys + (_klen<<1) - 2;
		while (1) {
			if ( _upper < _lower )
				break;

			_mid = _lower + (((_upper-_lower) >> 1) & ~1);
			if ( (*p) < _mid[0] )
				_upper = _mid - 2;
			else if ( (*p) > _mid[1] )
				_lower = _mid + 2;
			else {
				_trans += (unsigned int)((_mid - _keys)>>1);
				goto _match;
			}
		}
		_trans += _klen;
	}

_match:
	_trans = _uri_parser_indicies[_trans];
	cs = _uri_parser_trans_targs[_trans];

	if ( _uri_parser_trans_actions[_trans] == 0 )
		goto _again;

	_acts = _uri_parser_actions + _uri_parser_trans_actions[_trans];
	_nacts = (unsigned int) *_acts++;
	while ( _nacts-- > 0 )
	{
		switch ( *_acts++ )
		{
	case 0:
#line 34 "uri_parser.rl"
	{
    mark = p;
  }
	break;
	case 1:
#line 38 "uri_parser.rl"
	{
    uri_set_scheme(u, mark, p-mark);
  }
	break;
	case 2:
#line 42 "uri_parser.rl"
	{
    uri_set_userinfo(u, mark, p-mark);
  }
	break;
	case 3:
#line 46 "uri_parser.rl"
	{
    /* host may be called multiple times because
     * the parser isn't able to figure out the difference
     * between the userinfo and host until after the @ is encountered
     * FIXME: in that case there may be memory leak.
     * FIXME: for that something like GStringChunk can be developed
     */
    uri_set_host(u, mark, p-mark);
  }
	break;
	case 4:
#line 56 "uri_parser.rl"
	{
    if (mark) u->port = strtol(mark, NULL, 0);
  }
	break;
	case 5:
#line 60 "uri_parser.rl"
	{
    uri_set_path(u, mark, p-mark);
  }
	break;
	case 6:
#line 64 "uri_parser.rl"
	{
    uri_set_query(u, mark, p-mark);
  }
	break;
#line 779 "uri_parser.c"
		}
	}

_again:
	if ( cs == 0 )
		goto _out;
	if ( ++p != pe )
		goto _resume;
	_test_eof: {}
	if ( p == eof )
	{
	const char *__acts = _uri_parser_actions + _uri_parser_eof_actions[cs];
	unsigned int __nacts = (unsigned int) *__acts++;
	while ( __nacts-- > 0 ) {
		switch ( *__acts++ ) {
	case 0:
#line 34 "uri_parser.rl"
	{
    mark = p;
  }
	break;
	case 3:
#line 46 "uri_parser.rl"
	{
    /* host may be called multiple times because
     * the parser isn't able to figure out the difference
     * between the userinfo and host until after the @ is encountered
     * FIXME: in that case there may be memory leak.
     * FIXME: for that something like GStringChunk can be developed
     */
    uri_set_host(u, mark, p-mark);
  }
	break;
	case 4:
#line 56 "uri_parser.rl"
	{
    if (mark) u->port = strtol(mark, NULL, 0);
  }
	break;
	case 5:
#line 60 "uri_parser.rl"
	{
    uri_set_path(u, mark, p-mark);
  }
	break;
	case 6:
#line 64 "uri_parser.rl"
	{
    uri_set_query(u, mark, p-mark);
  }
	break;
	case 7:
#line 68 "uri_parser.rl"
	{
    uri_set_fragment(u, mark, p-mark);
  }
	break;
#line 837 "uri_parser.c"
		}
	}
	}

	_out: {}
	}

#line 113 "uri_parser.rl"

  if (cs == uri_parser_error && error_at != NULL) {
    *error_at = p;
  }

  return (cs != uri_parser_error && cs >= uri_parser_first_final);
}

void uri_print(uri_t *u) {
  if (!u) return;
  fprintf(stderr,
    "scheme=%s,userinfo=%s,host=%s,path=%s,query=%s,fragment=%s,port=%hu\n",
    u->scheme, u->userinfo, u->host, u->path, u->query, u->fragment, u->port
  );
}

void uri_clear(uri_t *u) {
  if (u == NULL) return;
  uri_zero(u);
}

void uri_free(uri_t *u) {
  if (!u) return;
  MYFREE(u->scheme);
  MYFREE(u->userinfo);
  MYFREE(u->host);
  MYFREE(u->path);
  MYFREE(u->query);
  MYFREE(u->fragment);
  MYFREE(u);
}

